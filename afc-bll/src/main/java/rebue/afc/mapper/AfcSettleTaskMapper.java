package rebue.afc.mapper;

import java.util.List;
import org.apache.ibatis.annotations.Mapper;
import rebue.afc.mo.AfcSettleTaskMo;
import rebue.robotech.mapper.MybatisBaseMapper;
import java.util.Date;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Select;
import org.apache.ibatis.annotations.Update;

@Mapper
public interface AfcSettleTaskMapper
		extends
			MybatisBaseMapper<AfcSettleTaskMo, Long> {
	/**
	 * This method was generated by MyBatis Generator. This method corresponds
	 * to the database table AFC_SETTLE_TASK
	 *
	 * @mbg.generated 2018-05-26 19:47:00
	 */
	int deleteByPrimaryKey(Long id);

	/**
	 * This method was generated by MyBatis Generator. This method corresponds
	 * to the database table AFC_SETTLE_TASK
	 *
	 * @mbg.generated 2018-05-26 19:47:00
	 */
	int insert(AfcSettleTaskMo record);

	/**
	 * This method was generated by MyBatis Generator. This method corresponds
	 * to the database table AFC_SETTLE_TASK
	 *
	 * @mbg.generated 2018-05-26 19:47:00
	 */
	int insertSelective(AfcSettleTaskMo record);

	/**
	 * This method was generated by MyBatis Generator. This method corresponds
	 * to the database table AFC_SETTLE_TASK
	 *
	 * @mbg.generated 2018-05-26 19:47:00
	 */
	AfcSettleTaskMo selectByPrimaryKey(Long id);

	/**
	 * This method was generated by MyBatis Generator. This method corresponds
	 * to the database table AFC_SETTLE_TASK
	 *
	 * @mbg.generated 2018-05-26 19:47:00
	 */
	int updateByPrimaryKeySelective(AfcSettleTaskMo record);

	/**
	 * This method was generated by MyBatis Generator. This method corresponds
	 * to the database table AFC_SETTLE_TASK
	 *
	 * @mbg.generated 2018-05-26 19:47:00
	 */
	int updateByPrimaryKey(AfcSettleTaskMo record);

	/**
	 * This method was generated by MyBatis Generator. This method corresponds
	 * to the database table AFC_SETTLE_TASK
	 *
	 * @mbg.generated 2018-05-26 19:47:00
	 */
	List<AfcSettleTaskMo> selectAll();

	/**
	 * This method was generated by MyBatis Generator. This method corresponds
	 * to the database table AFC_SETTLE_TASK
	 *
	 * @mbg.generated 2018-05-26 19:47:00
	 */
	List<AfcSettleTaskMo> selectSelective(AfcSettleTaskMo record);

	/**
	 * This method was generated by MyBatis Generator. This method corresponds
	 * to the database table AFC_SETTLE_TASK
	 *
	 * @mbg.generated 2018-05-26 19:47:00
	 */
	boolean existByPrimaryKey(Long id);

	/**
	 * This method was generated by MyBatis Generator. This method corresponds
	 * to the database table AFC_SETTLE_TASK
	 *
	 * @mbg.generated 2018-05-26 19:47:00
	 */
	boolean existSelective(AfcSettleTaskMo record);

	/**
	 * 获取计划执行时间在当前时间之前的任务列表
	 */
	@Select("select ID from AFC_SETTLE_TASK where EXECUTE_STATE=0 and EXECUTE_PLAN_TIME<=SYSDATE()")
	List<Long> selectByExecutePlanTimeBeforeNow();

	/**
	 * 执行任务完成
	 * 
	 * @param now
	 *            当前时间
	 * @param id
	 *            任务ID
	 * @param doneState
	 *            已执行状态
	 * @param noneState
	 *            未执行状态
	 * @return
	 */
	@Update("update AFC_SETTLE_TASK set EXECUTE_STATE=#{doneState}, EXECUTE_FACT_TIME=#{now} where ID=#{id} and EXECUTE_STATE=#{noneState}")
	int done(@Param("now") Date now, @Param("id") Long id,
			@Param("doneState") Byte doneState,
			@Param("noneState") Byte noneState);

	/**
	 * 订单是否已经结算完成
	 * 
	 * @param orderId
	 *            销售订单ID
	 */
	@Select("select CASE WHEN COUNT(*) > 0 THEN FALSE ELSE TRUE END from AFC_SETTLE_TASK where ORDER_ID=#{orderId} and EXECUTE_STATE!=#{doneState}")
	Boolean isSettleCompleted(@Param("orderId") String orderId,
			@Param("doneState") Byte doneState);
}